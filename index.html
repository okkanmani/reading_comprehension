<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RC Quiz — Science & Nature (5 passages)</title>
  <style>
    :root{
      --bg:#f4f7fb; --card:#ffffff; --accent:#0b66ff; --muted:#6b7280;
      --good:#ecfdf5; --good-text:#064e3b; --bad:#fff1f2; --bad-text:#7f1d1d;
      --explain-bg:#f8fafc; --max-width:1200px;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#0b1220;background:var(--bg)}
    .wrap{max-width:var(--max-width);margin:24px auto;padding:18px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 24px rgba(12,20,40,0.06)}
    header{display:flex;align-items:baseline;justify-content:space-between;gap:12px;margin-bottom:12px}
    header h1{margin:0;font-size:20px}
    header .muted{color:var(--muted);font-size:13px}
    .layout{display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:start}
    .passagePanel{padding:18px;overflow:auto;height:72vh}
    .questionsPanel{padding:14px;overflow:auto;height:72vh}
    .passTitle{font-size:24px;font-weight:700;margin-bottom:10px}
    .passageText{line-height:1.7;white-space:pre-wrap}
    .question{padding:10px;margin-bottom:12px;border-radius:8px;background:#fbfdff;border:1px solid #eef2ff}
    .qtext{font-weight:600;margin-bottom:8px}
    .muted{color:var(--muted);font-size:13px}
    label.option{display:block;padding:8px;margin:6px 0;border-radius:8px;cursor:pointer;border:1px solid transparent}
    label.option:hover{background:#f7fbff}
    input[type=radio]{margin-right:8px}
    .controls{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    button.secondary{background:#eef2ff;color:var(--accent);font-weight:600}
    button:disabled{opacity:0.5;cursor:default}
    .resultBox{margin-top:12px;padding:12px;border-radius:8px}
    .correct{background:var(--good);color:var(--good-text);padding:8px;border-radius:6px}
    .incorrect{background:var(--bad);color:var(--bad-text);padding:8px;border-radius:6px}
    .review-item{padding:8px;border-radius:8px;margin-bottom:8px;border:1px solid #eef2ff}
    .explanation{background:var(--explain-bg);padding:8px;border-radius:6px;margin-top:8px;font-size:14px}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    @media (max-width:980px){
      .layout{grid-template-columns:1fr;}.passagePanel{height:45vh}.questionsPanel{height:45vh}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div>
          <h1>Reading Comprehension — Science & Nature (Challenging)</h1>
          <div class="muted">5 passages • 6 questions each • 2 vocabulary questions per passage</div>
        </div>
        <div class="muted">Tip: Use <strong>Previous</strong> and <strong>Next</strong>. Submit appears on the last page.</div>
      </header>

      <div id="main" class="layout">
        <div class="passagePanel card">
          <div id="passageHeader" class="passTitle">Passage 1 of 5 — The Water Cycle and Why It Matters</div>
          <div id="passageText" class="passageText"></div>

          <div class="controls" style="justify-content:flex-start;margin-top:16px">
            <button id="prevBtn" class="secondary">Previous</button>
          </div>
        </div>

        <div class="questionsPanel card">
          <div class="muted" id="qHeader">Questions</div>
          <div id="questionsContainer"></div>

          <div class="controls" style="margin-top:12px">
            <button id="nextBtn" class="secondary">Next</button>
            <button id="submitBtn" style="display:none">Submit</button>
          </div>

          <div id="feedback" style="margin-top:12px"></div>
        </div>
      </div>

      <footer class="muted">This quiz runs entirely in your browser. No data leaves your device.</footer>
    </div>
  </div>

<script>
/* shuffle helper */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

/* ===== Passages, Questions, Explanations =====
Each passage has: title, text, questions [{q, choices[], a (index), explanation}]
*/
const passages = [
  {
    title: "The world’s weirdest animals",
    text: `The natural world is filled with amazing creatures, but some animals are truly weird and wonderful. For example, the axolotl, a kind of salamander, can regrow its limbs, its heart, and even parts of its brain! This remarkable ability means that if an axolotl loses a leg, it can grow a new one — something very rare in the animal kingdom. Another strange creature is the narwhal, often called the unicorn of the sea, due to the long, spiral tusk that protrudes from its head. These tusks can grow up to 10 feet long and are actually elongated teeth. Then there's the platypus, a unique mammal that lays eggs like a bird but feeds its young milk like other mammals. It also has a bill like a duck and webbed feet, making it look like a combination of many different animals.

Despite their odd appearances and abilities, these animals have adapted perfectly to their environments. The axolotl lives mostly underwater in lakes in Mexico and can breathe through its skin. The narwhal swims in the cold Arctic waters, using its tusk possibly for sensing its environment. The platypus is found in rivers and lakes of Australia and uses electroreception to hunt for food underwater. These examples show just how diverse and fascinating life on Earth can be, and how evolution can create some of the most unexpected creatures.`,
    questions: [
      {
        q: "Word meaning — What does 'regrow' most nearly mean in the passage?",
        choices: ["To lose something", "To grow again", "To change shape", "To disappear"],
        a: 1,
        explanation: "'Regrow' means to grow something again after losing it."
      },
      {
        q: "Word meaning — What does 'elongated' mean as used to describe the narwhal's tusk?",
        choices: ["Short and round", "Long and stretched out", "Broken", "Curved inward"],
        a: 1,
        explanation: "'Elongated' means something that is longer than usual or stretched out."
      },
      {
        q: "Why is the axolotl's ability to regrow limbs important?",
        choices: [
          "It helps the axolotl survive injuries.",
          "It makes the axolotl faster.",
          "It lets the axolotl change colors.",
          "It helps the axolotl fly."
        ],
        a: 0,
        explanation: "Regrowing limbs allows the axolotl to recover from harm and live longer."
      },
      {
        q: "What can we infer about the narwhal’s tusk?",
        choices: [
          "It is used for defense or sensing the environment.",
          "It helps the narwhal fly.",
          "It is a fake tusk.",
          "It helps the narwhal swim faster."
        ],
        a: 0,
        explanation: "The passage suggests the tusk might help the narwhal sense its surroundings."
      },
      {
        q: "What is the main idea of the passage?",
        choices: [
          "Some animals have unusual features that help them survive.",
          "All animals live underwater.",
          "Animals can change their colors.",
          "Animals with strange features are dangerous."
        ],
        a: 0,
        explanation: "The passage describes weird animals and their unique adaptations."
      }
    ]
  },
  {
    title: "The importance of recycling",
    text: `Recycling is the process of turning used materials into new products instead of throwing them away. It helps reduce waste, save natural resources, and prevent pollution. When we recycle paper, plastic, metal, and glass, fewer trees need to be cut down, less energy is used to make new products, and less garbage goes to landfills. Recycling also reduces greenhouse gases that cause climate change. By sorting our trash properly and recycling whenever possible, everyone can help protect the planet for future generations.

Many cities have special bins for recycling and encourage residents to separate their waste. Not recycling can lead to overflowing landfills, harmful pollution, and loss of valuable resources. It also increases the amount of energy needed to produce new materials, which can hurt the environment. Recycling is a simple way to make a big difference and helps keep the Earth cleaner and healthier.`,
    questions: [
      {
        q: "Word meaning — What does the word 'landfills' mean in the passage?",
        choices: ["Places to grow plants", "Places to throw trash", "Factories that recycle", "Parks for animals"],
        a: 1,
        explanation: "'Landfills' are places where garbage is buried or dumped."
      },
      {
        q: "Word meaning — What does 'greenhouse gases' refer to here?",
        choices: ["Gases that help plants grow", "Gases that trap heat and cause climate change", "Gases in the ocean", "Gases used in recycling"],
        a: 1,
        explanation: "'Greenhouse gases' trap heat in the atmosphere, causing global warming."
      },
      {
        q: "Why is recycling important according to the passage?",
        choices: [
          "It helps make more trash.",
          "It wastes natural resources.",
          "It saves resources and reduces pollution.",
          "It makes products more expensive."
        ],
        a: 2,
        explanation: "Recycling reduces waste and saves natural resources."
      },
      {
        q: "What can we infer happens if people don’t recycle?",
        choices: [
          "More trees will be cut down.",
          "There will be less trash.",
          "Energy will be saved.",
          "Pollution will decrease."
        ],
        a: 0,
        explanation: "Without recycling, new materials require cutting down more trees."
      },
      {
        q: "What is the author’s main purpose in this passage?",
        choices: [
          "To explain how recycling helps the planet.",
          "To tell how to plant trees.",
          "To describe how to make plastic.",
          "To explain why we shouldn’t recycle."
        ],
        a: 0,
        explanation: "The passage encourages recycling by explaining its benefits."
      }
    ]
  },
  {
    title: "Why leaves change color in autumn",
    text: `During autumn, many trees' leaves change color from green to bright reds, oranges, and yellows. This happens because trees prepare for winter by stopping the production of chlorophyll, the green pigment that helps leaves make food from sunlight. As the green fades, other pigments like carotenoids and anthocyanins become visible, giving the leaves their beautiful colors. Carotenoids produce yellows and oranges, while anthocyanins cause reds and purples.

This color change is more than just pretty; it helps trees conserve water and energy during the cold months when it’s harder to survive. When chlorophyll disappears, the tree reabsorbs valuable nutrients from the leaves before they fall off. The process also helps protect the tree from damage caused by frost or freezing temperatures. So, the bright autumn leaves we enjoy each year are part of the tree’s survival strategy.`,
    questions: [
      {
        q: "Word meaning — What does 'chlorophyll' mean in this passage?",
        choices: [
          "A green pigment in leaves that helps make food",
          "A type of animal",
          "A kind of soil",
          "A type of tree root"
        ],
        a: 0,
        explanation: "'Chlorophyll' is the green substance in leaves used to make food from sunlight."
      },
      {
        q: "Word meaning — What does 'pigments' most likely mean?",
        choices: [
          "Colors or substances that give color",
          "Types of animals",
          "Parts of roots",
          "Tools used by trees"
        ],
        a: 0,
        explanation: "'Pigments' are natural substances that give plants their colors."
      },
      {
        q: "Why do leaves change color in autumn?",
        choices: [
          "Because trees stop making chlorophyll",
          "Because leaves die immediately",
          "Because of animals eating leaves",
          "Because trees grow faster"
        ],
        a: 0,
        explanation: "Trees stop producing chlorophyll, revealing other pigments."
      },
      {
        q: "What can we infer about why trees conserve water and energy in autumn?",
        choices: [
          "Because water is scarce and survival is harder in winter",
          "Because leaves need more water",
          "Because it rains a lot in autumn",
          "Because animals drink the water"
        ],
        a: 0,
        explanation: "Trees prepare for tough winter conditions by conserving resources."
      },
      {
        q: "What is the main idea of the passage?",
        choices: [
          "Leaves change color to help trees survive winter.",
          "Leaves always stay green.",
          "Animals cause leaves to change color.",
          "Trees grow new leaves in autumn."
        ],
        a: 0,
        explanation: "The passage explains the reason and process of leaf color change."
      }
    ]
  },
  {
    title: "Ocean currents and their impact on weather",
    text: `Ocean currents are like giant rivers flowing through the sea, moving warm and cold water across the globe. These currents affect the weather by warming or cooling nearby lands. For example, the Gulf Stream carries warm water from the Gulf of Mexico to northern Europe, making places like the UK warmer than other regions at similar latitudes. This is why the UK has milder winters compared to parts of Canada, even though they are at similar distances from the equator.

Ocean currents also influence storms and rainfall patterns. Warm currents can increase the chance of storms by heating the air above them. Cold currents can cool the air and reduce rainfall. These currents affect marine life too, bringing nutrients that support fish and other sea creatures. Understanding ocean currents is important because they play a big role in the Earth's climate system and help predict weather changes that affect people everywhere.`,
    questions: [
      {
        q: "Word meaning — What are 'ocean currents'?",
        choices: [
          "Small fish in the sea",
          "Giant rivers of moving water in the ocean",
          "Waves that hit the shore",
          "Underwater mountains"
        ],
        a: 1,
        explanation: "Ocean currents are large streams of moving water within the ocean."
      },
      {
        q: "Word meaning — What does 'latitude' mean in this passage?",
        choices: [
          "The distance north or south of the equator",
          "The height of mountains",
          "The depth of the ocean",
          "The speed of the wind"
        ],
        a: 0,
        explanation: "'Latitude' refers to how far north or south a place is from the equator."
      },
      {
        q: "How does the Gulf Stream affect northern Europe?",
        choices: [
          "By making it colder than usual",
          "By bringing warm water and warming the region",
          "By causing heavy snowfall",
          "By making the sea very salty"
        ],
        a: 1,
        explanation: "The Gulf Stream moves warm water that keeps northern Europe warmer."
      },
      {
        q: "What can we infer about the importance of ocean currents?",
        choices: [
          "They only affect fish",
          "They influence weather and marine life",
          "They make the ocean shallow",
          "They stop storms from forming"
        ],
        a: 1,
        explanation: "Ocean currents impact both climate and sea creatures."
      },
      {
        q: "Why is understanding ocean currents important?",
        choices: [
          "To predict weather and protect communities",
          "To find treasure",
          "To build boats",
          "To stop fish from moving"
        ],
        a: 0,
        explanation: "Knowing about currents helps forecast weather changes that affect people."
      }
    ]
  },
  {
    title: "The water cycle and why it matters",
    text: `The water cycle is the journey water takes as it moves from the earth to the sky and back again. It is essential for all life on Earth because it helps distribute fresh water. The cycle starts when the sun heats water in oceans, rivers, or lakes, causing it to evaporate and turn into vapor. This vapor rises into the air, where it cools and forms clouds in a process called condensation. When the clouds become heavy, water falls back to the earth as precipitation — rain, snow, sleet, or hail.

Once the water reaches the ground, it may soak into the soil and become groundwater or run off into rivers and lakes. Plants also play a role by releasing water vapor into the air through transpiration. This continuous cycle moves water through different states and locations, supporting plants, animals, and humans. Without the water cycle, fresh water would not be recycled, and life on Earth would struggle to survive.`,
    questions: [
      {
        q: "Word meaning — What does 'evaporate' mean in the passage?",
        choices: [
          "To turn from liquid into vapor",
          "To freeze into ice",
          "To fall as rain",
          "To soak into the ground"
        ],
        a: 0,
        explanation: "'Evaporate' means water changes from liquid to gas and rises into the air."
      },
      {
        q: "Word meaning — What is 'condensation'?",
        choices: [
          "Water vapor cooling and forming clouds",
          "Water falling as rain",
          "Water soaking into soil",
          "Plants drinking water"
        ],
        a: 0,
        explanation: "'Condensation' is when vapor cools and becomes liquid droplets in clouds."
      },
      {
        q: "Why is the water cycle important?",
        choices: [
          "It recycles fresh water essential for life.",
          "It makes rivers disappear.",
          "It stops rain from falling.",
          "It makes the ocean salty."
        ],
        a: 0,
        explanation: "The water cycle ensures fresh water is reused and distributed."
      },
      {
        q: "What role do plants have in the water cycle?",
        choices: [
          "They release water vapor into the air through transpiration.",
          "They block rain from falling.",
          "They make water salty.",
          "They stop evaporation."
        ],
        a: 0,
        explanation: "Plants release water vapor which helps continue the water cycle."
      },
      {
        q: "What can we infer happens if the water cycle stopped?",
        choices: [
          "Fresh water would become scarce and life would suffer.",
          "It would rain nonstop.",
          "The oceans would dry up.",
          "Clouds would get bigger."
        ],
        a: 0,
        explanation: "Without the water cycle, fresh water wouldn't recycle, hurting living things."
      }
    ]
  },
  {
    title: "The invention of the printing press",
    text: `Before the invention of the printing press in the 15th century, books were copied by hand, which was slow and expensive. Johannes Gutenberg invented the first movable type printing press around 1440 in Germany, which revolutionized how information was shared. This invention allowed for many copies of books to be made quickly and cheaply, making books more available to ordinary people, not just the wealthy or clergy.

The printing press played a key role in spreading knowledge, ideas, and literacy throughout Europe and eventually the world. It helped fuel the Renaissance, the Reformation, and the Scientific Revolution by allowing thinkers to share their discoveries widely. Newspapers, pamphlets, and books could be produced on a large scale, changing society forever. The printing press is often called one of the most important inventions in human history because it made knowledge more democratic and accessible.`,
    questions: [
      {
        q: "Word meaning — What does 'movable type' mean in the passage?",
        choices: [
          "Letters that can be arranged and reused for printing",
          "Books that move",
          "Handwritten books",
          "Paper that changes size"
        ],
        a: 0,
        explanation: "'Movable type' are individual letters that can be moved to print many pages."
      },
      {
        q: "Word meaning — What does 'revolutionized' mean here?",
        choices: [
          "Changed something completely",
          "Made things worse",
          "Stopped printing",
          "Copied by hand"
        ],
        a: 0,
        explanation: "'Revolutionized' means it caused a big, important change."
      },
      {
        q: "Why was the printing press important?",
        choices: [
          "It made books cheaper and more available.",
          "It made books harder to get.",
          "It stopped people from reading.",
          "It only printed pictures."
        ],
        a: 0,
        explanation: "The press allowed many books to be made fast and cheaply."
      },
      {
        q: "What can we infer about the impact of the printing press on society?",
        choices: [
          "It helped spread knowledge and ideas widely.",
          "It made people less educated.",
          "It was only useful for artists.",
          "It slowed down the sharing of ideas."
        ],
        a: 0,
        explanation: "The press allowed important ideas to reach more people quickly."
      },
      {
        q: "What does the passage suggest about books before the printing press?",
        choices: [
          "They were copied slowly by hand and expensive.",
          "They were printed quickly and cheaply.",
          "Everyone could easily get books.",
          "Books did not exist."
        ],
        a: 0,
        explanation: "Before the press, books were made by hand, which took a long time and cost much."
      }
    ]
  }
];

/* ===== State & UI elements ===== */
let page = 0;
const totalPages = passages.length;
const answers = {}; // store selected original index per question, e.g., 'p0q1': 2

const passageHeader = document.getElementById('passageHeader');
const passageText = document.getElementById('passageText');
const qsContainer = document.getElementById('questionsContainer');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const submitBtn = document.getElementById('submitBtn');
const feedback = document.getElementById('feedback');
const qHeader = document.getElementById('qHeader');

const renderedQuestionNodes = {}; // track rendered nodes for inserting explanations

/* Render page */
function renderPage(idx) {
  const p = passages[idx];
  passageHeader.textContent = `Passage ${idx+1} of ${totalPages} — ${p.title}`;
  passageText.textContent = p.text;
  qsContainer.innerHTML = '';
  qHeader.textContent = `Questions — Passage ${idx+1}`;
  // clear rendered map
  for (const k in renderedQuestionNodes) delete renderedQuestionNodes[k];

  p.questions.forEach((q, qi) => {
    const qKey = `p${idx}q${qi}`;
    const qDiv = document.createElement('div');
    qDiv.className = 'question';
    qDiv.id = qKey;

    const qTitle = document.createElement('div');
    qTitle.className = 'qtext';
    qTitle.textContent = `Q${qi+1}. ${q.q}`;
    qDiv.appendChild(qTitle);

    // Shuffle display order but keep original indices
    const choiceObjs = q.choices.map((c, i) => ({ text: c, origIndex: i }));
    shuffle(choiceObjs);

    const labels = [];
    choiceObjs.forEach((ch, ci) => {
      const id = `${qKey}c${ci}`;
      const label = document.createElement('label');
      label.className = 'option';
      label.htmlFor = id;
      const radio = document.createElement('input');
      radio.type = 'radio';
      radio.name = qKey;
      radio.id = id;
      radio.value = ch.origIndex; // store original index for grading

      if (answers[qKey] !== undefined && answers[qKey] === ch.origIndex) {
        radio.checked = true;
      }

      radio.addEventListener('change', () => {
        answers[qKey] = Number(radio.value);
      });

      label.appendChild(radio);
      label.appendChild(document.createTextNode(ch.text));
      qDiv.appendChild(label);
      labels.push(label);
    });

    qsContainer.appendChild(qDiv);
    renderedQuestionNodes[qKey] = { container: qDiv, labels: labels, questionObj: q };
  });

  prevBtn.disabled = idx === 0;
  nextBtn.disabled = idx === totalPages - 1;
  submitBtn.style.display = (idx === totalPages - 1) ? 'inline-block' : 'none';
  feedback.innerHTML = '';
}

/* Grading and explanations insertion */
function gradeAllAndShow() {
  let total = 0, score = 0;
  const fullReview = document.createElement('div');

  passages.forEach((p, pi) => {
    const passBlock = document.createElement('div');
    passBlock.style.marginBottom = '12px';
    const passTitle = document.createElement('div');
    passTitle.style.fontWeight = '700';
    passTitle.textContent = `Passage ${pi+1}: ${p.title}`;
    passBlock.appendChild(passTitle);

    p.questions.forEach((q, qi) => {
      total++;
      const key = `p${pi}q${qi}`;
      const chosen = answers[key] !== undefined ? Number(answers[key]) : null;
      const isCorrect = chosen === q.a;
      if (isCorrect) score++;

      // If this question is currently visible, insert explanation directly under it
      const rendered = renderedQuestionNodes[key];
      if (rendered && rendered.container) {
        const oldExpl = rendered.container.querySelector('.explanation');
        if (oldExpl) oldExpl.remove();

        const expl = document.createElement('div');
        expl.className = 'explanation';

        const status = document.createElement('div');
        status.style.fontWeight = '700';
        status.style.marginBottom = '6px';
        if (isCorrect) {
          status.textContent = `✅ Correct — You chose: ${chosen === null ? 'Unanswered' : q.choices[chosen]}`;
          status.style.color = 'var(--good-text)';
        } else {
          status.textContent = `❌ ${chosen === null ? 'Unanswered' : 'Incorrect'} — Your answer: ${chosen === null ? 'Unanswered' : q.choices[chosen]}; Correct: ${q.choices[q.a]}`;
          status.style.color = 'var(--bad-text)';
        }
        expl.appendChild(status);

        const expt = document.createElement('div');
        expt.textContent = q.explanation || '';
        expl.appendChild(expt);

        rendered.container.appendChild(expl);

        // highlight labels
        rendered.labels.forEach(lbl => {
          const inp = lbl.querySelector('input[type=radio]');
          if (!inp) return;
          const val = Number(inp.value);
          if (val === q.a) {
            lbl.style.border = '1px solid #bfe6c8';
            lbl.style.background = '#f0fff4';
          }
          if (chosen !== null && val === chosen && chosen !== q.a) {
            lbl.style.border = '1px solid #ffd6d6';
            lbl.style.background = '#fff6f6';
          }
        });
      }

      // Build full-review item
      const item = document.createElement('div');
      item.className = 'review-item';
      const qn = document.createElement('div');
      qn.className = 'qtext';
      qn.textContent = `Passage ${pi+1} — Q${qi+1}. ${q.q}`;
      item.appendChild(qn);

      const your = document.createElement('div');
      your.style.marginTop = '6px';
      your.textContent = `Your answer: ${chosen === null ? 'Unanswered' : q.choices[chosen]}`;
      item.appendChild(your);

      const correctDiv = document.createElement('div');
      correctDiv.style.marginTop = '6px';
      correctDiv.textContent = `Correct answer: ${q.choices[q.a]}`;
      item.appendChild(correctDiv);

      const explanDiv = document.createElement('div');
      explanDiv.style.marginTop = '6px';
      explanDiv.textContent = q.explanation || '';
      item.appendChild(explanDiv);

      passBlock.appendChild(item);
    });

    fullReview.appendChild(passBlock);
  });

  feedback.innerHTML = '';
  const scoreBox = document.createElement('div');
  scoreBox.className = 'resultBox';
  scoreBox.innerHTML = `<div style="font-weight:700">Score: ${score} / ${total}</div><div class="small" style="margin-top:6px">Explanations appear beneath visible questions; full review follows.</div>`;
  feedback.appendChild(scoreBox);
  feedback.appendChild(fullReview);

  disableAllInputs();
  feedback.scrollIntoView({ behavior: 'smooth' });
}

/* disable inputs and nav */
function disableAllInputs() {
  const radios = document.querySelectorAll('input[type=radio]');
  radios.forEach(r => r.disabled = true);
  prevBtn.disabled = true;
  nextBtn.disabled = true;
  submitBtn.disabled = true;
}

/* Events */
prevBtn.addEventListener('click', () => {
  if (page > 0) {
    page--;
    renderPage(page);
  }
});
nextBtn.addEventListener('click', () => {
  if (page < totalPages - 1) {
    page++;
    renderPage(page);
  }
});
submitBtn.addEventListener('click', () => {
  if (!confirm("Submit answers and view explanations? You won't be able to change answers afterward.")) return;
  gradeAllAndShow();
});

/* Init */
renderPage(page);

</script>
</body>
</html>
