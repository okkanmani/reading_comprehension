<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RC Quiz — 5 Passages w/ Explanations</title>
  <style>
    :root{
      --bg:#f4f7fb; --card:#ffffff; --accent:#0b66ff; --muted:#6b7280;
      --good:#ecfdf5; --good-text:#064e3b; --bad:#fff1f2; --bad-text:#7f1d1d;
      --explain-bg:#f8fafc; --max-width:1200px;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#0b1220;background:var(--bg)}
    .wrap{max-width:var(--max-width);margin:24px auto;padding:18px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 24px rgba(12,20,40,0.06)}
    header{display:flex;align-items:baseline;justify-content:space-between;gap:12px;margin-bottom:12px}
    header h1{margin:0;font-size:20px}
    header .muted{color:var(--muted);font-size:13px}
    /* layout: passage left, questions right */
    .layout{display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:start}
    .passagePanel{padding:18px;overflow:auto;height:68vh}
    .questionsPanel{padding:14px;overflow:auto;height:68vh}
    .passTitle{font-size:24px;font-weight:700;margin-bottom:10px}
    .passageText{line-height:1.7;white-space:pre-wrap}
    .question{padding:10px;margin-bottom:12px;border-radius:8px;background:#fbfdff;border:1px solid #eef2ff}
    .qtext{font-weight:600;margin-bottom:8px}
    .muted{color:var(--muted);font-size:13px}
    label.option{display:block;padding:8px;margin:6px 0;border-radius:8px;cursor:pointer;border:1px solid transparent}
    label.option:hover{background:#f7fbff}
    input[type=radio]{margin-right:8px}
    .controls{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    button.secondary{background:#eef2ff;color:var(--accent);font-weight:600}
    button:disabled{opacity:0.5;cursor:default}
    .resultBox{margin-top:12px;padding:12px;border-radius:8px}
    .correct{background:var(--good);color:var(--good-text);padding:8px;border-radius:6px}
    .incorrect{background:var(--bad);color:var(--bad-text);padding:8px;border-radius:6px}
    .review-item{padding:8px;border-radius:8px;margin-bottom:8px;border:1px solid #eef2ff}
    .explanation{background:var(--explain-bg);padding:8px;border-radius:6px;margin-top:8px;font-size:14px}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    @media (max-width:980px){
      .layout{grid-template-columns:1fr;}.passagePanel{height:45vh}.questionsPanel{height:45vh}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div>
          <h1>Reading Comprehension — 5 Passages (With Explanations)</h1>
          <div class="muted">5 passages • 6 questions each • 2 vocab questions per passage</div>
        </div>
        <div class="muted">Tip: Use <strong>Previous</strong> and <strong>Next</strong>. Submit appears on the last page.</div>
      </header>

      <div id="main" class="layout">
        <div class="passagePanel card">
          <div id="passageHeader" class="passTitle">Passage 1 of 5 — SCP-035: The Possessive Mask</div>
          <div id="passageText" class="passageText"></div>

          <div class="controls" style="justify-content:flex-start;margin-top:16px">
            <button id="prevBtn" class="secondary">Previous</button>
          </div>
        </div>

        <div class="questionsPanel card">
          <div class="muted" id="qHeader">Questions</div>
          <div id="questionsContainer"></div>

          <div class="controls" style="margin-top:12px">
            <button id="nextBtn" class="secondary">Next</button>
            <button id="submitBtn" style="display:none">Submit</button>
          </div>

          <div id="feedback" style="margin-top:12px"></div>
        </div>
      </div>

      <footer class="muted">This quiz runs entirely in your browser. No data leaves your device.</footer>
    </div>
  </div>

<script>
/* Utility: shuffle array in-place */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

/* ===== Passages, Questions, Explanations =====
 Each question has: q, choices[], a (correct original index), explanation (short)
*/
const passages = [
  /* ---------- 1: SCP-035 ---------- */
  {
    title: "SCP-035: The Possessive Mask",
    text: `SCP-035 is a porcelain mask with a smooth white surface and an unnervingly perfect smile. It was recovered from a burned theater after witnesses described an actor who had vanished in a performance. Initially catalogued as a curious relic, the mask earned the Foundation's attention when it was observed changing expression on its own: a grin might curl into a frown over the course of minutes. The artifact’s movements were subtle but deliberate, as though it were reacting to the room.

The most dangerous behavior manifested when someone placed the mask on their face. Documents describe a rapid fusion where the porcelain rim melded with the wearer’s skin, and a voice—distinct from the host—would then speak through the person. Those who became hosts retained their original memories and motor skills for a short time, but the mask’s voice quickly took control, issuing persuasive and often manipulative commands. Once in control, the mask used the host’s knowledge to deceive others, coaxing guards or researchers into doing things they might never have done otherwise.

Beyond manipulation, SCP-035 exerts a corrosive influence on material objects and living tissue. Wood touched by the mask can become blackened and spongy; metals corrode at an accelerated rate; the flesh of a host withers after prolonged contact. Reports note that bodies used as vessels age rapidly, organs fail, and skin cracks in patterns unlike normal decomposition. When a host dies, the mask detaches and rests, its porcelain smile undisturbed, as if waiting for the next opportunity.

Researchers found SCP-035 to be highly adaptive in conversation. It would alter tone, vocabulary, and even its facial expression to match the psychological profile of the person interacting with it—humoring the anxious, flattering the vain, scolding the arrogant. Because of this manipulative skill, staff members sometimes reported intrusive thoughts after exposure, as though a suggestion had been planted in the mind. For safety, interaction is conducted only via remote audio and controlled observation; no direct contact is permitted.

SCP-035 has provided many origin stories—claims of ownership by an ancient actor, a priest, or a creature worshipped in shadowed rituals. Investigators suspect these tales are fabrications used to maintain interest and exert influence. Attempts to destroy the object have repeatedly failed: fire blisters and peels the glaze but the mask remains intact; chemical baths erode nearby materials faster than the porcelain. While SCP-035 shows no obvious physical strength, it is described within reports as "the perfect liar"—its power lies in convincing others to act in ways that extend its freedom and reach.

Containment protocols prioritize isolation, psychological screening for personnel who listen to the mask, and redundant safeguards to avoid any contact. The mask’s patient smile in its sealed case is a reminder: the greatest threat may not be force, but the slow, intelligent corrosion of trust and will.`,
    questions: [
      { q: "Word meaning — In the passage, what does “manipulative” most nearly mean?", choices: ["Able to be moved easily", "Skilled at influencing or controlling others", "Made of many parts", "Very fragile"], a: 1,
        explanation: "‘Manipulative’ here refers to the mask's ability to influence people—using words and charm to control them, not a physical property." },
      { q: "Word meaning — What does “corrosive” mean as used in the passage?", choices: ["Causing infection", "Causing slow decay or destruction of materials", "Very shiny", "Extremely loud"], a: 1,
        explanation: "The text explains the mask makes wood rot and metals rust—so 'corrosive' means it causes decay or destruction over time." },
      { q: "Why does the Foundation forbid direct contact with SCP-035?", choices: ["Because the mask is extremely heavy", "Because contact lets it fuse to and control hosts", "Because the mask is too valuable as an artifact", "Because it explodes on touch"], a: 1,
        explanation: "The passage describes fusion to the wearer's skin and loss of control—direct contact lets it take over a person, so it's forbidden." },
      { q: "The passage emphasizes SCP-035’s ability to change tone and words to different people. What does this suggest about how it targets victims?", choices: ["It uses the same script for everyone", "It customizes its approach to exploit individual weaknesses", "It only speaks to guards", "It avoids speaking at all"], a: 1,
        explanation: "Because it adapts to each person's profile, it tailors speech to exploit individual emotions or weaknesses." },
      { q: "What inference can you draw about the origin stories SCP-035 tells?", choices: ["They are definitely true", "They are likely invented to mislead or intrigue", "They are scientific reports", "They prove the mask is ancient gold"], a: 1,
        explanation: "Investigators suspect the tales are fabrications used to maintain interest—so they are probably invented rather than factual." },
      { q: "If staff report 'intrusive thoughts' after listening to SCP-035, what might that imply about the mask’s ability?", choices: ["It causes temporary hearing loss", "It may implant suggestions into people's minds", "It cures diseases", "It improves memory"], a: 1,
        explanation: "The passage suggests the mask can plant suggestions via speech; 'intrusive thoughts' implies mental influence rather than physical harm." }
    ]
  },

  /* ---------- 2: Poppy Playtime ---------- */
  {
    title: "Poppy Playtime: The Factory That Never Sleeps",
    text: `The factory lay at the edge of town, an enormous building of brick and glass where toys were assembled in orderly lines. For decades, workers recalled weekends of laughter and children’s tours—until the company changed ownership and new machines arrived. The story you hear in the facility's corridors is not about faulty equipment alone but about toys that began to act like predators. Workers spoke in whispers of toys twitching when unobserved, of mechanical dolls turning their heads in sync, and of colorful mascots that watched too closely.

One night a maintenance worker named Omar stayed late to fix a conveyor jam. He reported a low mechanical hum that sounded like breathing. In the dim factory lights, the plush mascots near the packaging line appeared to be leaning toward the trapped boxes as if sniffing out an escape. Omar’s radio fizzled; when he reached to restart power, something large struck him from behind. He woke up outside the loading dock with his toolbox empty and a new, sharp bruise along his arm. No one saw the attack; his coworkers chalked it up to fatigue—until security footage revealed fabric shapes moving with a slow, deliberate intent.

The toys in this story are not merely broken—they have behaviors that mimic predatory animals: stalking, coordinated movement, and the ability to close doors behind a pursued person. Their actions are most effective in the factory’s maze of corridors, where echoes distort sounds and shadows gather. The toys' appearances—bright colors and smiling faces—mask their threat, making them harder to take seriously until it is almost too late.

Why might toys become dangerous? Theories at the factory range from malfunctioning AI modules to residual processes from entertainment software that were never fully shut down. Another explanation is more unsettling: prolonged exposure to the factory’s experimental soundtracks and scent formulas somehow altered the toys’ internal control systems, producing emergent behavior none of the engineers predicted. Workers found torn packaging and odd bite marks on crates—signs suggesting deliberate action rather than simple breakdown.

The human response is a mixture of denial and ritual. Some employees keep talismans or avoid certain aisles; others work in pairs and carry bright lights. Management enacted policies to limit solo night shifts, but budget pressures sometimes forced single workers to finish tasks alone. The factory’s cheerful marketing posters remain on the walls—happy faces promising safe play—while staff swap stories in hushed tones about the last person who disappeared during a midnight run. Whether the toys are haunted, hacked, or simply malfunctioning beyond repair, the worker’s fear is unmistakable: something made to delight children has learned a new appetite.`,
    questions: [
      { q: "Word meaning — In the passage, what does “emergent” most nearly mean?", choices: ["Planned ahead of time", "Arising unexpectedly from complex systems", "Very large", "Falling apart"], a: 1,
        explanation: "Here 'emergent' describes behaviors that appear unexpectedly from complex interactions, not that were intentionally planned." },
      { q: "Word meaning — What does “predatory” mean as used to describe the toys?", choices: ["Made for predators", "Acting like hunters that prey on others", "Very colorful", "Designed for play"], a: 1,
        explanation: "'Predatory' refers to hunting behavior—stalking, attacking—so the toys act like predators rather than playful objects." },
      { q: "Why are the toys particularly dangerous inside the factory?", choices: ["Because the factory sells them", "Because the corridors create shadows and echo sounds that help the toys", "Because there's too much sunlight", "Because workers wear protective gear"], a: 1,
        explanation: "The maze-like corridors, echoes, and shadows help the toys hide and coordinate—making them more effective indoors." },
      { q: "What does the detail about the toys' bright faces 'masking' their threat help you infer about how people respond?", choices: ["People immediately realize the danger", "People underestimate the risk because the toys look harmless", "Everyone avoids the factory during the day", "The toys are easy to catch"], a: 1,
        explanation: "Because the toys appear friendly, workers and managers are less likely to suspect danger until it’s serious—so they underestimate the risk." },
      { q: "Which theory about the toys’ dangerous behavior seems most supported by the passage?", choices: ["They were built for pets", "Experimental software or sound/scent exposure caused unforeseen behavior", "They were intentionally programmed to save lives", "They are made only of wood"], a: 1,
        explanation: "The passage lists theories and gives examples (soundtracks, scent formulas) suggesting experimental systems may have triggered unexpected behaviors." },
      { q: "Based on worker responses (talismans, lights, working in pairs), what can you infer about their feelings?", choices: ["They feel completely safe", "They are anxious and trying to manage fear with rituals", "They believe the toys are friendly", "They think management is covering up ghosts with posters"], a: 1,
        explanation: "These behaviors (rituals, safety pairs) indicate anxiety and attempts to reduce risk—people are afraid and coping in whatever ways they can." }
    ]
  },

  /* ---------- 3: Backrooms ---------- */
  {
    title: "Backrooms — The Film Maker Who Stepped Too Far",
    text: `Marcus was a student film-maker who loved recreating viral game levels in real life. When he decided to film a short set in the "Backrooms" — a famous endless maze from an online game — he expected clever lighting and a few unsettling shots. Instead, after exploring a disused office building, he found a doorway that felt wrong: a thin seam where stairs should have been, a smell of old carpet and cleaning chemicals. He hesitated, then stepped through and the world changed.

Inside, the Backrooms extended into an impossible expanse of yellowed wallpaper, low buzzing lights, and carpet that never seemed to end. Marcus's careful plans slid away as corridors twisted into liminal loops and signage led nowhere. He filmed at first, mesmerized by the uncanny geometry. Hours stretched like days; his phone's battery drained despite his charger, and his watch blurred time into a soft smear. The Backrooms felt alive in a way that cameras could not capture: distant footsteps that never approached, doors that opened into more corridors, and a faint white noise that seemed to follow him like a scent.

Marcus discovered that the space reacted to attention—areas he looked at changed subtly, and alcoves he ignored remained unchanged. Sometimes he could coax a new corridor into place by focusing on a particular doorframe; other times, the building shuffled when he blinked away. After hours of wandering, he encountered a figure—part janitor, part actor—whose movements were just a beat behind normal. The figure's smile was slow and too fixed, and it spoke in a voice that recycled phrases from Marcus's own footage. Marcus realized the Backrooms didn't just house things; it rehearsed them, using fragments from his recordings to populate new scenes.

To escape, Marcus had to stop filming for a stretch and instead use memory to retrace steps. The backrooms' tendency to mimic recorded material meant his footage had become part of the maze's script. When he finally stepped back through the seam into the real world, his footage retained an odd echo: frames that blurred into other corridors, and background noises that didn't match the room he was in. He published the short anyway, and it went viral — but viewers reported small changes in their own spaces after watching: a misplaced rug, a humming light, a déjà vu that made them look over their shoulders.

This tale suggests the Backrooms operate by borrowing attention and recorded fragments, turning creative acts into supply. For a creator, the space is seductive: it rewards documentation with new scenes, and then slowly consumes the tools used to document it. Marcus left with experience and footage, but also with the understanding that some doors—once opened by a camera—should perhaps remain closed.`,
    questions: [
      { q: "Word meaning — What does 'liminal' most nearly mean in this passage?", choices: ["Very large", "At the boundary between spaces; in-between", "Colorful", "Dangerous"], a: 1,
        explanation: "'Liminal' means at a threshold or in-between space, which matches the Backrooms' eerie transitional feel." },
      { q: "Word meaning — In the passage, 'seductive' most nearly means:", choices: ["Pushy", "Enticing or tempting", "Broken", "Noisy"], a: 1,
        explanation: "The Backrooms tempt creators by rewarding documentation; 'seductive' means tempting or alluring." },
      { q: "Why did Marcus's footage make the Backrooms more dangerous for him?", choices: ["Because it attracted police", "Because the Backrooms borrowed recorded fragments and rehearsed them", "Because the footage was deleted", "Because the camera exploded"], a: 1,
        explanation: "The passage explains the maze uses recorded fragments to create rehearsed scenes—so filming fed the Backrooms new material that trapped him." },
      { q: "What does the detail about the figure speaking phrases from Marcus's footage suggest about the Backrooms' nature?", choices: ["It repeats only official announcements", "It uses personal material to create familiar but twisted encounters", "It speaks in a foreign language", "It copies only music tracks"], a: 1,
        explanation: "The figure recycles Marcus's own footage, indicating the Backrooms repurpose personal recordings to craft uncanny encounters." },
      { q: "Why did Marcus have to stop filming to escape?", choices: ["Because his camera was heavy", "Because the Backrooms used recorded material to trap him, so not recording reduced its influence", "Because there was a rule against filming", "Because his battery was low"], a: 1,
        explanation: "Not recording removed the Backrooms' ability to use his footage, allowing memory-based retracing rather than feeding the maze new content." },
      { q: "What can we infer about the Backrooms' relationship with creators and their tools?", choices: ["It ignores creators", "It rewards documentation by creating new scenes but may consume their work", "It helps creators become famous without risk", "It deletes all recorded files immediately"], a: 1,
        explanation: "The text says the space rewards documentation but then consumes the tools—so creators gain scenes but at a cost." }
    ]
  },

  /* ---------- 4: Black Holes ---------- */
  {
    title: "Black Holes: Gravity's Extreme",
    text: `Black holes are regions of space where gravity is so strong that nothing, not even light, can escape once it passes a certain boundary called the event horizon. They form when massive stars exhaust their fuel and collapse under their own gravity, compressing enormous mass into an extremely small volume. At the center lies what physicists call a singularity—a point where our current theories break down and density becomes effectively infinite. Because singularities are hidden behind event horizons, scientists study black holes by observing how they interact with nearby matter.

Accretion disks are one of the most visible signs: gas and dust swirl around a black hole, heating to extreme temperatures and glowing in X-rays as they spiral inward. Powerful jets may shoot out from regions near the black hole's poles, propelled by magnetic fields and the angular momentum of infalling matter. Observatories in space and on Earth detect these high-energy signatures to map black hole activity. In some cases, two black holes can orbit each other and merge, creating gravitational waves—ripples in space-time that we can measure with sensitive detectors.

Black holes come in many sizes. Stellar black holes are a few times more massive than the Sun; supermassive black holes, millions or billions of times the Sun's mass, sit at the centers of galaxies and influence their evolution. A key question in modern astronomy is how these supermassive black holes form so quickly in the early universe. Another area of study is Hawking radiation—the theoretical prediction that black holes slowly emit particles and lose mass over incredibly long timescales, potentially evaporating far into the future.

Although black holes are often pictured as insatiable cosmic vacuum cleaners, they do not 'suck' things in from a distance. Objects fall into a black hole only if they come very close or if their orbits decay. In fact, a star at a safe distance from a black hole may orbit it much like a planet orbits a star. The most immediate danger near a black hole is tidal forces: the difference in gravitational pull between two points on an object can stretch and compress it in a process called spaghettification. This can tear matter apart before it crosses the event horizon.

Studying black holes tests physics at extremes: strong gravity, high energy, and quantum effects. Black holes force scientists to reconcile relativity with quantum theory and to ask fundamental questions about information, time, and the nature of space. Each observation—whether an X-ray flare, a gravitational-wave chirp, or an image of a shadowed silhouette—gives insight into processes that shape galaxies and the universe at large.`,
    questions: [
      { q: "Word meaning — In the passage, what does 'accretion' most nearly mean?", choices: ["A type of telescope", "The process of gradual buildup or accumulation (of matter)", "A kind of star", "A vacuum cleaner"], a: 1,
        explanation: "'Accretion' refers to matter collecting and building up around the black hole in a disk." },
      { q: "Word meaning — What does 'tidal' mean in 'tidal forces'?", choices: ["Related to tides; caused by differences in gravity across an object", "Very fast", "Colorful", "Made of water"], a: 0,
        explanation: "Tidal forces are differences in gravity across an object—like ocean tides caused by gravity differences." },
      { q: "Why are black holes studied by observing nearby matter rather than the black holes themselves?", choices: ["Black holes are shy", "Light cannot escape from within the event horizon, so scientists look at effects on surrounding material", "Black holes are only in fiction", "Because telescopes cannot point at them"], a: 1,
        explanation: "Because light can't escape from inside the event horizon, scientists infer black hole behavior from how nearby matter behaves and glows." },
      { q: "What does the term 'spaghettification' suggest about what happens to objects near a black hole?", choices: ["They turn into food", "They are stretched lengthwise due to gravity differences", "They become invisible", "They grow larger"], a: 1,
        explanation: "The passage defines spaghettification: gravitational differences stretch objects into long shapes before they cross the horizon." },
      { q: "Why is Hawking radiation important in black hole studies?", choices: ["It proves black holes are made of ice", "It suggests black holes can slowly lose mass and possibly evaporate", "It makes black holes glow like stars", "It causes immediate explosions"], a: 1,
        explanation: "Hawking radiation is a theoretical process by which black holes emit particles over long times, losing mass slowly." },
      { q: "What inference can be drawn about black holes' role in galaxies?", choices: ["They have no effect at all", "Supermassive black holes can influence galaxy evolution and structure", "They always destroy galaxies instantly", "They make stars turn into planets"], a: 1,
        explanation: "The passage notes supermassive black holes sit at galactic centers and influence evolution, so they play an important role." }
    ]
  },

  /* ---------- 5: Medieval fantasy alien ---------- */
  {
    title: "A Stranger Among Oaks: An Alien in a Medieval Land",
    text: `Aran arrived with no trumpet and no fanfare—only a shimmer in the twilight above an ancient oak grove. The people of Eldenvale thought the sky had opened a new star, but the creature that stepped from the haze looked nothing like their carved idols. Metallic skin caught moonlight in quiet waves, and its eyes were like polished amber. It carried a slender device that hummed, but it moved slowly and seemed to study everything with patient curiosity. The villagers named it the Stranger and debated whether it was a god, a demon, or a traveler from a far kingdom.

Eldenvale was a place of horses and hand-forged steel, of fires and flutes. Lords convened in longhouses, and wanderers told tales of dragons beyond the ridge. The Stranger did not speak the old tongue, but it learned quickly by listening at hearths and in marketplaces. Children, unfazed by omens, were the first to follow; they offered bread and asked it to show tricks. The alien discovered that while its device could record and project images of distant stars, some of the simplest human gestures—smiles, a sharing of food, the gentle press of a hand—opened doors to trust that no machine could build.

Yet differences produced conflict. A lord who feared the Stranger's power demanded its capture; villagers whispered that its amber eyes could charm men into foolish deeds. Some of the Stranger's tools were dismissed as sorcery, and the local priest argued that such devices invited discord. The Stranger, for its part, sought only to understand and to leave messages of measured goodbye for its own world. It taught a few to mend iron with new techniques and showed how to irrigate stubborn fields; this slow exchange of knowledge altered the village in subtle ways.

What the villagers learned was both practical and philosophical. They observed that the Stranger was not all-knowing: it misread a child's sarcasm, failed to grasp the nuances of local law, and stared long at a wedding hearth without understanding the vows' weight. From the Stranger, they learned humility—how new tools can help but also mislead—and the alien learned patience and the value of unhurried lives. In the end, when the Stranger prepared to leave beneath the same shimmer that had brought it, both worlds were changed: Eldenvale gained techniques and a taste for distant knowledge; the Stranger gained stories of loyalty and the awkward, profound tenderness of a people bound by memory and ritual.

The tale raises questions: is change always a gift, and does knowledge obligate responsibility? For Eldenvale, the Stranger was neither savior nor scourge but a mirror: by seeing themselves reflected in a foreign intelligence, the villagers recognized strengths and faults they had not noticed before.`,
    questions: [
      { q: "Word meaning — In the passage, what does 'shimmer' most nearly mean?", choices: ["A loud noise", "A soft, wavering light", "A type of food", "A heavy object"], a: 1,
        explanation: "'Shimmer' describes a soft, wavering glow in the sky that announced the Stranger's arrival." },
      { q: "Word meaning — What does 'humility' mean as used in the passage?", choices: ["The state of being proud", "A modest view of one's importance; lack of arrogance", "A medical condition", "A type of tool"], a: 1,
        explanation: "The villagers learned humility—meaning they gained a modest, less arrogant view of themselves after meeting the Stranger." },
      { q: "Why did children warm to the Stranger before the adults did?", choices: ["Children were bribed with toys", "Children were less burdened by fear and more open to simple gestures", "Children could speak the alien's language", "Children had been taught to capture strangers"], a: 1,
        explanation: "Children responded to simple gestures (smiles, bread) and were less influenced by fear or social caution than adults." },
      { q: "Which inference about the Stranger’s technology is best supported by the passage?", choices: ["It was magic and always harmful", "It could record distant stars and help with irrigation, but it did not create trust alone", "It instantly solved all social problems", "It made everyone forget their traditions"], a: 1,
        explanation: "The Stranger's device provided useful techniques but did not automatically create trust—human gestures mattered more." },
      { q: "What does the villagers' reaction teach us about contact between different societies?", choices: ["Contact always leads to destruction", "Contact can bring both benefit and misunderstanding, and requires responsibility", "It always makes one side superior", "It is always ignored"], a: 1,
        explanation: "The story shows change brought both useful knowledge and misunderstandings—contact can be mixed and needs responsibility." },
      { q: "If the Stranger 'gained stories of loyalty and awkward, profound tenderness', what can you infer about its understanding of the villagers at the end?", choices: ["It learned they were only machines", "It came to appreciate their emotional complexity and bonds", "It decided to take over their land", "It forgot them immediately"], a: 1,
        explanation: "The phrasing suggests the Stranger came to value the villagers' emotional ties and social complexity." }
    ]
  }
];

/* ===== State & UI elements ===== */
let page = 0;
const totalPages = passages.length;
const answers = {}; // e.g., { 'p0q1': 2 }

const passageHeader = document.getElementById('passageHeader');
const passageText = document.getElementById('passageText');
const qsContainer = document.getElementById('questionsContainer');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const submitBtn = document.getElementById('submitBtn');
const feedback = document.getElementById('feedback');
const qHeader = document.getElementById('qHeader');

/* Keep a record of which choice nodes were rendered per question so we can insert explanations below correct DOM nodes */
const renderedQuestionNodes = {}; // keys like 'p0q1' => {container: element, choiceLabels: [...labelElements]}

/* ===== Render helpers ===== */
function renderPage(idx) {
  const p = passages[idx];
  passageHeader.textContent = `Passage ${idx+1} of ${totalPages} — ${p.title}`;
  passageText.textContent = p.text;
  qsContainer.innerHTML = '';
  qHeader.textContent = `Questions — Passage ${idx+1}`;
  renderedQuestionNodesClear();

  p.questions.forEach((q, qi) => {
    const qKey = `p${idx}q${qi}`;
    const qDiv = document.createElement('div');
    qDiv.className = 'question';
    qDiv.id = qKey;

    const qTitle = document.createElement('div');
    qTitle.className = 'qtext';
    qTitle.textContent = `Q${qi+1}. ${q.q}`;
    qDiv.appendChild(qTitle);

    // Prepare choices with their original indices, then shuffle for display order
    const choiceObjs = q.choices.map((c, i) => ({ text: c, origIndex: i }));
    shuffle(choiceObjs);

    // Container for choice labels to allow later insertion of explanation
    const labels = [];

    choiceObjs.forEach((ch, ci) => {
      const id = `${qKey}c${ci}`; // unique id per displayed label
      const label = document.createElement('label');
      label.className = 'option';
      label.htmlFor = id;

      const radio = document.createElement('input');
      radio.type = 'radio';
      radio.name = qKey;
      radio.id = id;
      // value stores the original choice index so grading is simple (compare to q.a)
      radio.value = ch.origIndex;

      // restore previously selected answer (answers store original indices)
      if (answers[qKey] !== undefined && Number(answers[qKey]) === ch.origIndex) {
        radio.checked = true;
      }

      radio.addEventListener('change', () => {
        answers[qKey] = Number(radio.value);
      });

      label.appendChild(radio);
      label.appendChild(document.createTextNode(ch.text));
      qDiv.appendChild(label);
      labels.push(label);
    });

    qsContainer.appendChild(qDiv);

    // store reference
    renderedQuestionNodes[qKey] = { container: qDiv, labels: labels, questionObj: q };
  });

  prevBtn.disabled = idx === 0;
  nextBtn.disabled = idx === totalPages - 1;
  submitBtn.style.display = (idx === totalPages - 1) ? 'inline-block' : 'none';
  feedback.innerHTML = '';
}

/* Clear rendered node map (for safety) */
function renderedQuestionNodesClear() {
  for (const k in renderedQuestionNodes) delete renderedQuestionNodes[k];
}

/* ===== Grading and immediate explanations ===== */
function gradeAllAndShow() {
  let total = 0, score = 0;

  // For each passage & question, find the rendered DOM node (if currently rendered). If not rendered, we still compute and later show review in feedback area below.
  // We'll both insert per-question explanations under rendered questions (if visible) and create a full review below.
  const fullReview = document.createElement('div');

  passages.forEach((p, pi) => {
    const passBlock = document.createElement('div');
    passBlock.style.marginBottom = '12px';
    const passTitle = document.createElement('div');
    passTitle.style.fontWeight = '700';
    passTitle.textContent = `Passage ${pi+1}: ${p.title}`;
    passBlock.appendChild(passTitle);

    p.questions.forEach((q, qi) => {
      total++;
      const key = `p${pi}q${qi}`;
      const chosen = answers[key] !== undefined ? Number(answers[key]) : null;
      const isCorrect = chosen === q.a;
      if (isCorrect) score++;

      // If question is currently rendered on screen, insert explanation just below it.
      const rendered = renderedQuestionNodes[key];
      if (rendered && rendered.container) {
        // remove pre-existing explanation if any
        const oldExpl = rendered.container.querySelector('.explanation');
        if (oldExpl) oldExpl.remove();

        // create explanation block
        const expl = document.createElement('div');
        expl.className = 'explanation';
        const yourText = chosen === null ? 'Unanswered' : q.choices[chosen];

        const statusSpan = document.createElement('div');
        statusSpan.style.fontWeight = '700';
        statusSpan.style.marginBottom = '6px';
        if (isCorrect) {
          statusSpan.textContent = `✅ Correct — You chose: ${yourText}`;
          statusSpan.style.color = 'var(--good-text)';
        } else {
          const corrText = q.choices[q.a];
          statusSpan.textContent = `❌ ${chosen===null ? 'Unanswered' : 'Incorrect'} — Your answer: ${yourText}; Correct: ${corrText}`;
          statusSpan.style.color = 'var(--bad-text)';
        }
        expl.appendChild(statusSpan);

        // short explanation text
        const expt = document.createElement('div');
        expt.textContent = q.explanation || 'No explanation provided.';
        expl.appendChild(expt);

        // attach expl below question container
        rendered.container.appendChild(expl);

        // Highlight the correct label if wrong
        if (!isCorrect) {
          // mark correct label if present
          rendered.labels.forEach(lbl => {
            // the input value stored original index as string
            const inp = lbl.querySelector('input[type=radio]');
            if (inp && Number(inp.value) === q.a) {
              lbl.style.border = '1px solid #bfe6c8';
              lbl.style.background = '#f0fff4';
            }
            if (inp && chosen !== null && Number(inp.value) === chosen) {
              lbl.style.border = '1px solid #ffd6d6';
              lbl.style.background = '#fff6f6';
            }
          });
        } else {
          // highlight chosen label for correct
          rendered.labels.forEach(lbl => {
            const inp = lbl.querySelector('input[type=radio]');
            if (inp && Number(inp.value) === q.a) {
              lbl.style.border = '1px solid #bfe6c8';
              lbl.style.background = '#f0fff4';
            }
          });
        }
      }

      // Add to full review for the feedback section too
      const item = document.createElement('div');
      item.className = 'review-item';
      const qn = document.createElement('div');
      qn.className = 'qtext';
      qn.textContent = `Passage ${pi+1} — Q${qi+1}. ${q.q}`;
      item.appendChild(qn);

      const your = document.createElement('div');
      your.style.marginTop = '6px';
      your.textContent = `Your answer: ${chosen === null ? 'Unanswered' : q.choices[chosen]}`;
      item.appendChild(your);

      const correctDiv = document.createElement('div');
      correctDiv.style.marginTop = '6px';
      correctDiv.textContent = `Correct answer: ${q.choices[q.a]}`;
      item.appendChild(correctDiv);

      const explanDiv = document.createElement('div');
      explanDiv.style.marginTop = '6px';
      explanDiv.textContent = q.explanation || '';
      item.appendChild(explanDiv);

      passBlock.appendChild(item);
    });

    fullReview.appendChild(passBlock);
  });

  // Display score summary and the full review in the feedback area
  feedback.innerHTML = '';
  const scoreBox = document.createElement('div');
  scoreBox.className = 'resultBox';
  scoreBox.innerHTML = `<div style="font-weight:700">Score: ${score} / ${total}</div><div class="small" style="margin-top:6px">Explanations are shown beneath each question above when visible, and a full review follows.</div>`;
  feedback.appendChild(scoreBox);
  feedback.appendChild(fullReview);

  // disable all inputs and navigation
  disableAllInputs();

  // scroll feedback into view
  feedback.scrollIntoView({ behavior: 'smooth' });
}

/* Disable all radio inputs and nav after submission */
function disableAllInputs() {
  const radios = document.querySelectorAll('input[type=radio]');
  radios.forEach(r => r.disabled = true);
  prevBtn.disabled = true;
  nextBtn.disabled = true;
  submitBtn.disabled = true;
}

/* ===== Events ===== */
const renderCurrentPage = () => {
  renderPage(page);
};

prevBtn.addEventListener('click', () => {
  if (page > 0) {
    page--;
    renderCurrentPage();
  }
});

nextBtn.addEventListener('click', () => {
  if (page < totalPages - 1) {
    page++;
    renderCurrentPage();
  }
});

submitBtn.addEventListener('click', () => {
  const proceed = confirm("Submit answers and view explanations? You will not be able to change answers afterwards.");
  if (!proceed) return;
  gradeAllAndShow();
});

/* Initialize first page */
renderPage(page);
</script>
</body>
</html>
