<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RC Quiz — Science & Nature (5 passages)</title>
  <style>
    :root{
      --bg:#f4f7fb; --card:#ffffff; --accent:#0b66ff; --muted:#6b7280;
      --good:#ecfdf5; --good-text:#064e3b; --bad:#fff1f2; --bad-text:#7f1d1d;
      --explain-bg:#f8fafc; --max-width:1200px;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#0b1220;background:var(--bg)}
    .wrap{max-width:var(--max-width);margin:24px auto;padding:18px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 24px rgba(12,20,40,0.06)}
    header{display:flex;align-items:baseline;justify-content:space-between;gap:12px;margin-bottom:12px}
    header h1{margin:0;font-size:20px}
    header .muted{color:var(--muted);font-size:13px}
    .layout{display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:start}
    .passagePanel{padding:18px;overflow:auto;height:72vh}
    .questionsPanel{padding:14px;overflow:auto;height:72vh}
    .passTitle{font-size:24px;font-weight:700;margin-bottom:10px}
    .passageText{line-height:1.7;white-space:pre-wrap}
    .question{padding:10px;margin-bottom:12px;border-radius:8px;background:#fbfdff;border:1px solid #eef2ff}
    .qtext{font-weight:600;margin-bottom:8px}
    .muted{color:var(--muted);font-size:13px}
    label.option{display:block;padding:8px;margin:6px 0;border-radius:8px;cursor:pointer;border:1px solid transparent}
    label.option:hover{background:#f7fbff}
    input[type=radio]{margin-right:8px}
    .controls{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    button.secondary{background:#eef2ff;color:var(--accent);font-weight:600}
    button:disabled{opacity:0.5;cursor:default}
    .resultBox{margin-top:12px;padding:12px;border-radius:8px}
    .correct{background:var(--good);color:var(--good-text);padding:8px;border-radius:6px}
    .incorrect{background:var(--bad);color:var(--bad-text);padding:8px;border-radius:6px}
    .review-item{padding:8px;border-radius:8px;margin-bottom:8px;border:1px solid #eef2ff}
    .explanation{background:var(--explain-bg);padding:8px;border-radius:6px;margin-top:8px;font-size:14px}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    @media (max-width:980px){
      .layout{grid-template-columns:1fr;}.passagePanel{height:45vh}.questionsPanel{height:45vh}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div>
          <h1>Reading Comprehension — Science & Nature (Challenging)</h1>
          <div class="muted">5 passages • 6 questions each • 2 vocabulary questions per passage</div>
        </div>
        <div class="muted">Tip: Use <strong>Previous</strong> and <strong>Next</strong>. Submit appears on the last page.</div>
      </header>

      <div id="main" class="layout">
        <div class="passagePanel card">
          <div id="passageHeader" class="passTitle">Passage 1 of 5 — The Water Cycle and Why It Matters</div>
          <div id="passageText" class="passageText"></div>

          <div class="controls" style="justify-content:flex-start;margin-top:16px">
            <button id="prevBtn" class="secondary">Previous</button>
          </div>
        </div>

        <div class="questionsPanel card">
          <div class="muted" id="qHeader">Questions</div>
          <div id="questionsContainer"></div>

          <div class="controls" style="margin-top:12px">
            <button id="nextBtn" class="secondary">Next</button>
            <button id="submitBtn" style="display:none">Submit</button>
          </div>

          <div id="feedback" style="margin-top:12px"></div>
        </div>
      </div>

      <footer class="muted">This quiz runs entirely in your browser. No data leaves your device.</footer>
    </div>
  </div>

<script>
/* shuffle helper */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

/* ===== Passages, Questions, Explanations =====
Each passage has: title, text, questions [{q, choices[], a (index), explanation}]
*/
const passages = [
  /* 1) Water Cycle (approved passage) */
  {
    title: "The Water Cycle and Why It Matters",
    text: `Water on Earth is always moving. It travels from oceans and lakes into the air, falls as rain or snow, runs across the land into streams and rivers, soaks into the soil, and eventually returns to the seas. Scientists call this continual movement the water cycle, and it keeps fresh water available for plants, animals, and people. Although the names for the steps—evaporation, condensation, precipitation, infiltration, runoff, and transpiration—sound technical, each describes something you can observe: puddles drying in the sun, clouds forming, raindrops falling, and dew soaking into the ground.

Heat from the Sun is the engine of the water cycle. When sunlight warms the surface of oceans, lakes, and moist soil, molecules at the surface gain energy and move into the air as vapor—this is evaporation. Plants add to the vapor through transpiration, where water drawn from the soil passes through leaves and escapes as tiny droplets from leaf pores. In the atmosphere, rising moist air cools; water vapor condenses into tiny droplets that combine to form clouds. If clouds grow heavy enough, droplets fall as precipitation and replenish lakes, rivers, and groundwater.

The water cycle does more than deliver rainfall. It regulates climate: oceans store vast amounts of heat and release it slowly, while clouds reflect sunlight and influence temperatures. Groundwater stored beneath the surface feeds springs and wells, providing drinking water even during dry spells. Wetlands—bogs, marshes, and swamps—act like sponges, absorbing floodwater and releasing it slowly, which protects nearby towns from sudden surges after heavy storms.

Human activity affects the cycle. Cutting forests reduces transpiration and can change local rainfall patterns. Paving fields and building structures increases runoff, so less water soaks into the ground to recharge aquifers. Overdrawing groundwater for irrigation can lower the water table, causing wells to dry up and land to sink. Pollution also travels with water: chemicals and trash flushed into rivers may end up in oceans, harming ecosystems far downstream.

People can make choices that support a healthy water cycle. Planting trees restores transpiration and stabilizes soil; protecting wetlands preserves natural storage and filtration of water; and using water wisely—fixing leaks, choosing efficient irrigation, and conserving water during dry seasons—helps maintain groundwater levels. On a larger scale, reducing greenhouse gas emissions can limit the changes in climate that alter evaporation and precipitation patterns.

The water cycle shows how connected Earth’s systems are: a change in one region can affect weather, ecosystems, and resources elsewhere. By studying the cycle, scientists predict droughts and floods and help communities plan for resilient agriculture and safe water supplies. For citizens, understanding the water cycle helps explain why simple actions—like planting a tree or reducing waste—matter. Water isn’t an endless, separate resource: it’s part of a moving, balanced system we all share and depend upon.`,
    questions: [
      { q: "Word meaning — What does 'transpiration' most nearly mean in the passage?", choices: ["The movement of water from plants into the air", "The process of water forming clouds", "The draining of wetlands into rivers", "The mixing of river water with ocean water"], a: 0,
        explanation: "Transpiration is the process where plants release water vapor from their leaves into the air, as described in the passage." },
      { q: "Word meaning — What does 'infiltration' refer to in the water cycle?", choices: ["Water moving into the ground and recharging groundwater", "Water flowing across the surface as a stream", "Water evaporating into the air", "Water freezing into ice"], a: 0,
        explanation: "Infiltration is when water soaks into soil and replenishes groundwater, as listed among the water cycle steps." },
      { q: "Why might paving large areas increase flooding risk nearby?", choices: ["Paving makes rain fall more often", "Paving causes clouds to hold more water", "Paving increases runoff so less water soaks in", "Paving attracts storms"], a: 2,
        explanation: "Paving prevents water from soaking into the ground, increasing surface runoff and raising flood risk." },
      { q: "If a community preserves wetlands and plants trees, which is a likely result?", choices: ["Less groundwater recharge", "Increased groundwater recharge and reduced flood peaks", "Immediate dry rivers", "No more clouds"], a: 1,
        explanation: "Wetlands act like sponges and trees help stabilize soil and water cycles, improving recharge and moderating floods." },
      { q: "Which human action could cause wells to dry up over time?", choices: ["Installing solar panels", "Overdrawing groundwater for irrigation", "Planting native trees", "Building birdhouses"], a: 1,
        explanation: "Using too much groundwater lowers the water table and can cause wells to run dry." },
      { q: "Why do scientists study the water cycle when planning agriculture and water supplies?", choices: ["To stop rain forever", "To predict droughts and floods and manage resources", "To make plants grow without sunlight", "To turn all water into drinking water"], a: 1,
        explanation: "Understanding the cycle helps predict extreme events and supports planning for resilient water and food systems." }
    ]
  },

  /* 2) Why Leaves Change Color in Autumn */
  {
    title: "Why Leaves Change Color in Autumn",
    text: `Each fall, many trees transform their green leaves into a brilliant display of yellow, orange, red, and purple. This seasonal show is not just decoration; it's the result of a complex set of chemical changes inside the leaf that respond to shorter days and cooler nights. During spring and summer, leaves are green because they contain chlorophyll—the pigment that captures sunlight and powers photosynthesis, the process by which plants make food. When daylight shortens in autumn, chlorophyll production slows and eventually stops. As the green pigment fades, other pigments present in the leaf become visible.

Carotenoids are pigments that produce yellow and orange hues. They are present in the leaf through the growing season but are usually hidden by the dominant green of chlorophyll. Anthocyanins, which can create red and purple shades, are often produced in the autumn when sugars accumulate in leaf tissues. The exact mix of pigments determines the palette for each species and even for individual trees—weather, soil conditions, and genetics all play a role.

Why do trees go through this change at all? The color shift is part of a larger preparation for winter. As chlorophyll declines, trees begin to seal the base of each leaf with a layer of cells that will eventually cause the leaf to detach—this is the formation of an abscission layer. By shedding leaves, trees reduce water loss and protect themselves from damage during cold, dry months. Producing anthocyanins might also help protect leaves from light damage late in the season or deter insects that feed on weakened tissues.

Environmental factors affect color intensity and timing. Sunny days and cool—but not freezing—nights favor the formation of bright reds because sugars concentrate in leaves and stimulate anthocyanin production. A wet growing season followed by a warm fall may mute colors, while drought stress can cause leaves to brown and fall earlier. Different tree species show distinct color patterns: maples often turn fiery red, oaks may display russet tones, and birches glow golden.

People have long appreciated autumn colors for their beauty, but scientists study them because the patterns can indicate forest health and climate trends. Changes in the timing of color shifts over decades can signal shifts in seasonal climate, which affects ecosystems, agriculture, and wildlife migrations. Understanding leaf color helps researchers predict how forests will respond to changing temperature and rainfall patterns and informs conservation decisions.

In the end, the autumn display is the visible result of plants shifting priorities—no longer investing in growth for the year, they withdraw resources and prepare for the dormancy of winter. The spectacle we enjoy is a side effect of deeper strategies that help trees survive through seasons of scarcity.`,
    questions: [
      { q: "Word meaning — What does 'chlorophyll' do in leaves?", choices: ["Makes leaves wilt", "Captures sunlight for photosynthesis", "Stores water only", "Protects bark"], a: 1,
        explanation: "Chlorophyll is the green pigment that captures sunlight so the plant can make food by photosynthesis." },
      { q: "Word meaning — What does 'abscission' refer to in this passage?", choices: ["The process of forming a layer that helps a leaf detach", "A type of pigment", "A kind of insect", "The process of making roots"], a: 0,
        explanation: "Abscission is the formation of a cell layer at the leaf base that leads to the leaf falling off." },
      { q: "Why do anthocyanins often appear in autumn leaves?", choices: ["They are present all year and never change", "They form when sugars concentrate and can create reds and purples", "They are a type of insect", "They clean the leaf"], a: 1,
        explanation: "Anthocyanins are produced when sugars accumulate, often in cool sunny conditions, producing reds and purples." },
      { q: "Which weather pattern favors bright red colors in autumn?", choices: ["Cloudy days and warm nights", "Sunny days and cool nights (not freezing)", "Heavy snow", "Constant rain all day"], a: 1,
        explanation: "Sunny days and cool nights help sugar concentration in leaves, stimulating anthocyanin production and bright reds." },
      { q: "How can changes in timing of leaf color shifts help scientists?", choices: ["They show tree fashion trends", "They signal changes in seasonal climate affecting ecosystems", "They prove soil is the same everywhere", "They tell which animals sing louder"], a: 1,
        explanation: "Earlier or later color changes over years can indicate climate shifts, informing studies of ecosystems and migrations." },
      { q: "Why do trees drop leaves before winter according to the passage?", choices: ["To decorate the ground", "To reduce water loss and avoid damage during cold months", "To store more leaves later", "Because insects ask them to"], a: 1,
        explanation: "Shedding leaves reduces water loss and protects the tree during the cold, dry winter months." }
    ]
  },

  /* 3) What Causes Earthquakes */
  {
    title: "What Causes Earthquakes",
    text: `Earthquakes are sudden shaking events caused by the release of energy stored in Earth's crust. The crust is divided into large sections called tectonic plates that move slowly over the planet’s surface. Where plates interact—pulling apart, sliding past one another, or colliding—the rocks along faults can lock and store stress. When the stress exceeds the strength of the rocks, the fault slips suddenly, sending seismic waves through the ground that we feel as an earthquake.

Most earthquakes happen near plate boundaries: at spreading centers where plates move apart, at subduction zones where one plate dives beneath another, and along transform faults where plates slide horizontally. The location where the break starts under the ground is the focus (or hypocenter); the point directly above it on the surface is the epicenter. Seismometers record the vibrations, and by studying the arrival times of different seismic waves, scientists can locate quakes and estimate their magnitude.

Earthquakes vary widely: tiny tremors, often barely felt, occur daily around the world, while major events can cause widespread destruction. Strong shaking can collapse buildings, rupture roads and pipelines, and trigger landslides or tsunamis if the quake displaces the seafloor. Ground motion is influenced not only by how much energy is released but also by local geology—soft soils can amplify shaking, while solid bedrock may transmit waves differently.

Humans can also trigger earthquakes by altering stresses in the crust. Large reservoirs, fluid injection into deep wells, and some mining operations have been linked to increased seismicity in certain regions. Scientists monitor both natural and human-related seismic activity to understand risks. Building codes, early warning systems that detect initial seismic waves, and land-use planning that avoids unstable slopes or fill zones can reduce harm.

Predicting the exact time and place of earthquakes remains extremely difficult. However, by studying the history of past quakes and measuring strain accumulation along faults, scientists can identify places at higher risk and estimate probabilities for the coming decades. This information helps communities plan resilient infrastructure, prepare emergency supplies, and practice drills so citizens can respond quickly when shaking begins.

Understanding earthquakes is both a scientific and social task: it requires measuring and modeling Earth processes as well as designing policies and practices to protect lives and property. While we cannot yet stop earthquakes, careful planning and informed choices make societies safer in the face of this powerful natural hazard.`,
    questions: [
      { q: "Word meaning — In the passage, what does 'hypocenter' mean?", choices: ["The point on the surface directly above the earthquake origin", "The location where the earthquake starts underground (focus)", "A kind of earthquake machine", "A weather station"], a: 1,
        explanation: "The hypocenter (focus) is the underground point where the fault first slips; the epicenter is above on the surface." },
      { q: "Word meaning — What does 'seismic' refer to in 'seismic waves'?", choices: ["Related to earthquakes or ground vibrations", "Related to weather", "A type of soil", "A measuring tool"], a: 0,
        explanation: "'Seismic' refers to vibrations produced by earthquakes; seismometers record seismic waves." },
      { q: "Why do large earthquakes sometimes cause tsunamis?", choices: ["Because wind picks up water", "Because the quake can displace the seafloor, pushing water upward", "Because of sudden rain", "Because the moon changes orbit"], a: 1,
        explanation: "If a quake moves the ocean floor vertically, it can push a large volume of water and create tsunami waves." },
      { q: "How can human activities trigger earthquakes?", choices: ["Singing loudly near a fault", "Injecting fluids into deep wells or creating large reservoirs", "Planting trees", "Building houses on bedrock"], a: 1,
        explanation: "Activities that change underground pressures or stresses (like injection or reservoir loading) can induce seismicity in some settings." },
      { q: "What makes predicting exact earthquake times so difficult?", choices: ["Earthquakes are caused by weather only", "Complex fault behavior and variable strain accumulation make timing unpredictable", "Scientists never study past quakes", "Only animals can predict quakes"], a: 1,
        explanation: "Faults behave in complex ways and stress builds irregularly, so exact timing remains hard to predict despite long-term probability studies." },
      { q: "Which measure helps communities reduce earthquake damage?", choices: ["Ignoring past quakes", "Building codes and early warning systems", "Removing all seismometers", "Planting only one tree per town"], a: 1,
        explanation: "Stronger building codes, early warnings, and planning reduce harm even if quakes can't be precisely predicted." }
    ]
  },

  /* 4) Importance of Recycling */
  {
    title: "The Importance of Recycling",
    text: `Recycling means collecting used materials and transforming them into new products instead of throwing them away. Common recyclable items include paper, glass, metals, and certain plastics. Recycling helps conserve resources: reprocessing aluminum, for example, uses far less energy than producing it from raw ore. By using less new material, recycling reduces mining and logging, which preserves habitats and decreases greenhouse gas emissions.

Recycling also reduces landfill use. Landfills can pollute groundwater and take up valuable land; keeping materials in circulation helps slow the need for more disposal sites. Many cities provide curbside recycling bins, and materials are sorted at facilities to remove contaminants. Contamination—when non-recyclable items or food-soiled materials get mixed in—can spoil whole batches and make recycling less effective.

Circular economy is a concept tied to recycling: it aims to design products and systems so materials remain useful longer, are easier to repair, and can be remade at the end of their life. This approach reduces waste and the environmental cost of making new goods. Consumers play a role by choosing products with recycled content, reusing containers, and reducing single-use disposables. Businesses can also design packaging that is easier to recycle.

However, recycling is not a complete solution by itself. Some materials are costly to process, and markets for recycled goods can fluctuate. Incineration with energy recovery and other waste-management strategies are sometimes used alongside recycling. The most effective approach remains the "reduce, reuse, recycle" hierarchy—first cut consumption, then reuse items when possible, and recycle what cannot be reused.

Education matters: clear labeling and local instructions improve recycling rates because people know what belongs in the bin. Policies such as extended producer responsibility can shift the burden to manufacturers to design recyclable products and manage end-of-life collection. When communities and industries work together, recycling becomes part of a broader effort to reduce pollution, conserve resources, and move toward sustainable production systems.

Recycling connects daily decisions—choosing a reusable bag, rinsing and sorting containers—to global outcomes: fewer raw materials taken from nature, less pollution, and lower energy use. Those small choices, multiplied across millions of people, can make a measurable difference for ecosystems and climate.`,
    questions: [
      { q: "Word meaning — In the passage, what does 'contamination' mean in the recycling context?", choices: ["When recyclable items are mixed with non-recyclable or dirty materials", "Cleaning materials before recycling", "A special recycling plant", "A disease"], a: 0,
        explanation: "Contamination occurs when wrong or dirty items get into recycling streams and spoil batches, making recycling less effective." },
      { q: "Word meaning — What is a 'circular economy' most nearly?", choices: ["An economy based on circular roads", "A system where products are designed to be reused, repaired, and recycled", "A market that only sells rings", "A type of landfill"], a: 1,
        explanation: "A circular economy keeps materials in use longer by designing for reuse and recycling, reducing the need for new raw materials." },
      { q: "Why does recycling aluminum save energy?", choices: ["Because recycled aluminum is heavier", "Because reprocessing uses much less energy than making aluminum from ore", "Because aluminum cannot be recycled", "Because recycled aluminum floats"], a: 1,
        explanation: "Producing aluminum from recycled material requires far less energy than extracting and refining it from raw ore." },
      { q: "What is the correct order of the 'reduce, reuse, recycle' hierarchy?", choices: ["Recycle, reuse, reduce", "Reduce, reuse, recycle", "Reuse, recycle, reduce", "Recycle only"], a: 1,
        explanation: "The hierarchy prioritizes reducing consumption first, then reusing items, and recycling as a last step." },
      { q: "How can consumers help improve recycling systems?", choices: ["By ignoring labels", "By choosing products with recycled content and sorting materials correctly", "By burning their trash", "By throwing everything into one bin"], a: 1,
        explanation: "Buying recycled products and sorting materials correctly reduces contamination and supports recycling markets." },
      { q: "Why is recycling alone not enough to solve environmental problems?", choices: ["Because it always creates more waste", "Because some materials are costly to process and we also need to reduce consumption", "Because recycling makes pollution worse", "Because no one recycles"], a: 1,
        explanation: "Recycling helps but must be combined with reduced consumption, better design, and other waste strategies for full impact." }
    ]
  },

  /* 5) The World's Weirdest Animals */
  {
    title: "The World's Weirdest Animals",
    text: `Earth is home to an astonishing variety of animals, many of which seem stranger than fiction. Evolution has produced unusual shapes, clever tricks, and surprising behaviors that help species survive in special environments. Consider a few remarkable examples.

The platypus, found in eastern Australia, blends traits in ways that puzzled early scientists: it has a duck-like bill, webbed feet, a beaver-like tail, and lays eggs despite being a mammal. Male platypuses also have a venomous spur on each hind leg used during competition. In the deep sea, the anglerfish dangles a glowing lure above its enormous mouth to attract prey in the darkness; many species show extreme sexual dimorphism where tiny males fuse to larger females. The axolotl, a type of salamander, retains juvenile features into adulthood and can regenerate lost limbs—an ability of interest to medical researchers.

Other animals display odd behaviors: some birds use tools to extract insects from logs; octopuses can solve puzzles, change color, and escape enclosures; and certain species of frogs freeze solid during winter and then thaw back to life in spring. Insects too can be bizarre: the bombardier beetle defends itself by ejecting a hot chemical spray, while the bowerbird builds decorated structures and arranges colorful objects to attract mates.

These strange traits are not meaningless; they evolved because they helped organisms survive and reproduce in particular settings. A camouflage pattern may protect an insect from predators; an unusual mating display might attract a choosy mate; a toxin can deter predators. Scientists study these adaptations to understand evolutionary history and to find practical insights—research into spider silk or gecko feet influence materials science and engineering.

Many of the world’s oddest animals are also endangered. Habitat loss, pollution, and climate change threaten unique ecosystems where these species live. Protecting biodiversity preserves not only the species themselves but also the ecological roles they play—pollinators, predators, and seed distributors that keep ecosystems functioning.

People often respond to strange animals with curiosity and wonder, which can be powerful tools for conservation. When communities and schools learn about unique creatures in their region, they often become advocates for habitat protection and scientific study. Celebrating the planet’s oddities connects science to life and shows that evolutionary solutions can be creative, functional, and beautiful.`,
    questions: [
      { q: "Word meaning — In the passage, what does 'dimorphism' most nearly mean?", choices: ["Having two distinct forms within a species (such as male and female differences)", "Being very colorful", "Living in two places", "Being extremely small"], a: 0,
        explanation: "Dimorphism refers to species where males and females (or forms) look different, like some anglerfish." },
      { q: "Word meaning — What does 'camouflage' refer to in the passage?", choices: ["A protective color or pattern that helps hide an animal", "A type of food", "A sleeping behavior", "A loud call"], a: 0,
        explanation: "Camouflage helps animals blend with surroundings to avoid predators—an adaptive trait described in the passage." },
      { q: "Why might unusual traits like venom or chemical sprays evolve?", choices: ["To make animals weaker", "To deter predators or help in competition and survival", "To confuse humans only", "To make animals float"], a: 1,
        explanation: "Traits such as venom or sprays can protect animals from predators or help with competition, improving survival." },
      { q: "How do odd animal behaviors help scientists and engineers?", choices: ["They don't help at all", "They inspire technologies, like studying spider silk or gecko feet for materials", "They make animals stop evolving", "They cause machines to break"], a: 1,
        explanation: "Scientists imitate biological solutions—biomimicry—to create new materials or technologies inspired by animals." },
      { q: "Why is protecting habitats important for weird species?", choices: ["Because strange animals are aggressive", "Because many unique species are endangered and need ecosystems to survive", "Because habitats make animals uglier", "Because habitats stop weather"], a: 1,
        explanation: "Habitat loss threatens unique species; protecting ecosystems helps preserve biodiversity and ecological functions." },
      { q: "What role does public curiosity about odd animals play in conservation?", choices: ["It decreases interest in science", "It encourages people to protect habitats and become advocates", "It makes animals more dangerous", "It only helps zoos"], a: 1,
        explanation: "Curiosity often leads to education and advocacy, motivating communities to protect species and habitats." }
    ]
  }
];

/* ===== State & UI elements ===== */
let page = 0;
const totalPages = passages.length;
const answers = {}; // store selected original index per question, e.g., 'p0q1': 2

const passageHeader = document.getElementById('passageHeader');
const passageText = document.getElementById('passageText');
const qsContainer = document.getElementById('questionsContainer');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const submitBtn = document.getElementById('submitBtn');
const feedback = document.getElementById('feedback');
const qHeader = document.getElementById('qHeader');

const renderedQuestionNodes = {}; // track rendered nodes for inserting explanations

/* Render page */
function renderPage(idx) {
  const p = passages[idx];
  passageHeader.textContent = `Passage ${idx+1} of ${totalPages} — ${p.title}`;
  passageText.textContent = p.text;
  qsContainer.innerHTML = '';
  qHeader.textContent = `Questions — Passage ${idx+1}`;
  // clear rendered map
  for (const k in renderedQuestionNodes) delete renderedQuestionNodes[k];

  p.questions.forEach((q, qi) => {
    const qKey = `p${idx}q${qi}`;
    const qDiv = document.createElement('div');
    qDiv.className = 'question';
    qDiv.id = qKey;

    const qTitle = document.createElement('div');
    qTitle.className = 'qtext';
    qTitle.textContent = `Q${qi+1}. ${q.q}`;
    qDiv.appendChild(qTitle);

    // Shuffle display order but keep original indices
    const choiceObjs = q.choices.map((c, i) => ({ text: c, origIndex: i }));
    shuffle(choiceObjs);

    const labels = [];
    choiceObjs.forEach((ch, ci) => {
      const id = `${qKey}c${ci}`;
      const label = document.createElement('label');
      label.className = 'option';
      label.htmlFor = id;
      const radio = document.createElement('input');
      radio.type = 'radio';
      radio.name = qKey;
      radio.id = id;
      radio.value = ch.origIndex; // store original index for grading

      if (answers[qKey] !== undefined && answers[qKey] === ch.origIndex) {
        radio.checked = true;
      }

      radio.addEventListener('change', () => {
        answers[qKey] = Number(radio.value);
      });

      label.appendChild(radio);
      label.appendChild(document.createTextNode(ch.text));
      qDiv.appendChild(label);
      labels.push(label);
    });

    qsContainer.appendChild(qDiv);
    renderedQuestionNodes[qKey] = { container: qDiv, labels: labels, questionObj: q };
  });

  prevBtn.disabled = idx === 0;
  nextBtn.disabled = idx === totalPages - 1;
  submitBtn.style.display = (idx === totalPages - 1) ? 'inline-block' : 'none';
  feedback.innerHTML = '';
}

/* Grading and explanations insertion */
function gradeAllAndShow() {
  let total = 0, score = 0;
  const fullReview = document.createElement('div');

  passages.forEach((p, pi) => {
    const passBlock = document.createElement('div');
    passBlock.style.marginBottom = '12px';
    const passTitle = document.createElement('div');
    passTitle.style.fontWeight = '700';
    passTitle.textContent = `Passage ${pi+1}: ${p.title}`;
    passBlock.appendChild(passTitle);

    p.questions.forEach((q, qi) => {
      total++;
      const key = `p${pi}q${qi}`;
      const chosen = answers[key] !== undefined ? Number(answers[key]) : null;
      const isCorrect = chosen === q.a;
      if (isCorrect) score++;

      // If this question is currently visible, insert explanation directly under it
      const rendered = renderedQuestionNodes[key];
      if (rendered && rendered.container) {
        const oldExpl = rendered.container.querySelector('.explanation');
        if (oldExpl) oldExpl.remove();

        const expl = document.createElement('div');
        expl.className = 'explanation';

        const status = document.createElement('div');
        status.style.fontWeight = '700';
        status.style.marginBottom = '6px';
        if (isCorrect) {
          status.textContent = `✅ Correct — You chose: ${chosen === null ? 'Unanswered' : q.choices[chosen]}`;
          status.style.color = 'var(--good-text)';
        } else {
          status.textContent = `❌ ${chosen === null ? 'Unanswered' : 'Incorrect'} — Your answer: ${chosen === null ? 'Unanswered' : q.choices[chosen]}; Correct: ${q.choices[q.a]}`;
          status.style.color = 'var(--bad-text)';
        }
        expl.appendChild(status);

        const expt = document.createElement('div');
        expt.textContent = q.explanation || '';
        expl.appendChild(expt);

        rendered.container.appendChild(expl);

        // highlight labels
        rendered.labels.forEach(lbl => {
          const inp = lbl.querySelector('input[type=radio]');
          if (!inp) return;
          const val = Number(inp.value);
          if (val === q.a) {
            lbl.style.border = '1px solid #bfe6c8';
            lbl.style.background = '#f0fff4';
          }
          if (chosen !== null && val === chosen && chosen !== q.a) {
            lbl.style.border = '1px solid #ffd6d6';
            lbl.style.background = '#fff6f6';
          }
        });
      }

      // Build full-review item
      const item = document.createElement('div');
      item.className = 'review-item';
      const qn = document.createElement('div');
      qn.className = 'qtext';
      qn.textContent = `Passage ${pi+1} — Q${qi+1}. ${q.q}`;
      item.appendChild(qn);

      const your = document.createElement('div');
      your.style.marginTop = '6px';
      your.textContent = `Your answer: ${chosen === null ? 'Unanswered' : q.choices[chosen]}`;
      item.appendChild(your);

      const correctDiv = document.createElement('div');
      correctDiv.style.marginTop = '6px';
      correctDiv.textContent = `Correct answer: ${q.choices[q.a]}`;
      item.appendChild(correctDiv);

      const explanDiv = document.createElement('div');
      explanDiv.style.marginTop = '6px';
      explanDiv.textContent = q.explanation || '';
      item.appendChild(explanDiv);

      passBlock.appendChild(item);
    });

    fullReview.appendChild(passBlock);
  });

  feedback.innerHTML = '';
  const scoreBox = document.createElement('div');
  scoreBox.className = 'resultBox';
  scoreBox.innerHTML = `<div style="font-weight:700">Score: ${score} / ${total}</div><div class="small" style="margin-top:6px">Explanations appear beneath visible questions; full review follows.</div>`;
  feedback.appendChild(scoreBox);
  feedback.appendChild(fullReview);

  disableAllInputs();
  feedback.scrollIntoView({ behavior: 'smooth' });
}

/* disable inputs and nav */
function disableAllInputs() {
  const radios = document.querySelectorAll('input[type=radio]');
  radios.forEach(r => r.disabled = true);
  prevBtn.disabled = true;
  nextBtn.disabled = true;
  submitBtn.disabled = true;
}

/* Events */
prevBtn.addEventListener('click', () => {
  if (page > 0) {
    page--;
    renderPage(page);
  }
});
nextBtn.addEventListener('click', () => {
  if (page < totalPages - 1) {
    page++;
    renderPage(page);
  }
});
submitBtn.addEventListener('click', () => {
  if (!confirm("Submit answers and view explanations? You won't be able to change answers afterward.")) return;
  gradeAllAndShow();
});

/* Init */
renderPage(page);

</script>
</body>
</html>
